<script>
// Новий графік відключень
const outages = {
    "Група 1.1": [],
    "Група 1.2": [["13:30", "16:00"]],
    "Група 2.1": [["10:00", "13:30"]],
    "Група 2.2": [["16:00", "18:00"]],
    "Група 3.1": [["16:00", "18:00"]],
    "Група 3.2": [["18:00", "20:00"]],
    "Група 4.1": [["10:00", "13:30"]],
    "Група 4.2": [["18:00", "20:00"]],
    "Група 5.1": [],
    "Група 5.2": [["13:30", "16:00"]],
    "Група 6.1": [],
    "Група 6.2": [["20:00", "22:00"]]
};

// Переведення часу у хвилини
function toMinutes(t) {
    const [h, m] = t.split(":").map(Number);
    return h * 60 + m;
}

const COLOR_POWER_ON = "#FFD700"; // жовтий – світло є
const COLOR_POWER_OFF = "#000000"; // чорний – світла немає

let groups = Object.keys(outages);
let traces = [];

// Формування ліній
groups.forEach(group => {
    const intervals = outages[group];

    // Якщо відключень немає — весь день жовта лінія
    if (intervals.length === 0) {
        traces.push({
            x: [0, 1440],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_ON },
            hoverinfo: "text",
            text: `${group}: Електроенергія є`,
            showlegend: false
        });
        return;
    }

    let last = 0;

    intervals.forEach(interval => {
        const start = toMinutes(interval[0]);
        const end = toMinutes(interval[1]);

        // Ділянка зі світлом (жовта)
        if (start > last) {
            traces.push({
                x: [last, start],
                y: [group, group],
                mode: "lines",
                line: { width: 18, color: COLOR_POWER_ON },
                hoverinfo: "text",
                text: `${group}: Електроенергія є`,
                showlegend: false
            });
        }

        // Відключення (чорна)
        traces.push({
            x: [start, end],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_OFF },
            hoverinfo: "text",
            text: `${group}: Відключення ${interval[0]}–${interval[1]}`,
            showlegend: false
        });

        last = end;
    });

    // Хвіст дня зі світлом
    if (last < 1440) {
        traces.push({
            x: [last, 1440],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_ON },
            hoverinfo: "text",
            text: `${group}: Електроенергія є`,
            showlegend: false
        });
    }
});

// Поточний час
function getCurrentMinutes() {
    const now = new Date();
    return now.getHours() * 60 + now.getMinutes();
}

const layout = {
    title: "Відключення електроенергії по всіх групах",
    showlegend: false,
    xaxis: {
        title: "Час",
        range: [0, 1440],
        tickvals: Array.from({ length: 25 }, (_, i) => i * 60),
        ticktext: Array.from({ length: 25 }, (_, i) => `${i}:00`)
    },
    yaxis: { title: "Групи" },
    shapes: [
        {
            type: "line",
            x0: getCurrentMinutes(),
            x1: getCurrentMinutes(),
            y0: -1,
            y1: groups.length,
            line: { color: "red", width: 2, dash: "dash" }
        }
    ]
};

Plotly.newPlot("chart", traces, layout);

// Оновлення червоної лінії щохвилини
setInterval(() => {
    const current = getCurrentMinutes();
    Plotly.relayout("chart", {
        "shapes[0].x0": current,
        "shapes[0].x1": current
    });
}, 60000);
</script>













