<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Графік відключень електроенергії</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #fafafa;
        }
        h1 {
            margin-bottom: 5px;
        }
        #chart {
            width: 100%;
            max-width: 1400px;
            height: 800px;
        }
    </style>
</head>
<body>

<h1>Графік погодинних відключень на 08.12.2025</h1>
<p><b>Оновлено: 19:17 07.12.2025</b></p>

<div id="chart"></div>

<script>
// Новий графік відключень
const outages = {
    "Група 1.1": [["00:00", "01:30"], ["05:00", "08:30"], ["12:00", "19:00"], ["22:30", "24:00"]],
    "Група 1.2": [["05:00", "12:00"], ["15:30", "22:30"]],
    "Група 2.1": [["00:00", "01:30"], ["06:00", "12:00"], ["15:30", "22:00"]],
    "Група 2.2": [["05:00", "08:30"], ["12:00", "19:00"], ["22:30", "24:00"]],
    "Група 3.1": [["01:30", "05:00"], ["08:30", "15:30"], ["19:00", "24:00"]],
    "Група 3.2": [["00:00", "02:00"], ["08:00", "12:00"], ["15:30", "22:30"]],
    "Група 4.1": [["03:00", "08:30"], ["12:00", "19:00"], ["22:30", "24:00"]],
    "Група 4.2": [["01:30", "08:30"], ["12:00", "19:00"], ["22:30", "24:00"]],
    "Група 5.1": [["00:00", "05:00"], ["08:30", "15:30"], ["19:00", "22:30"]],
    "Група 5.2": [["00:00", "03:00"], ["08:30", "15:30"], ["19:00", "22:30"]],
    "Група 6.1": [["00:00", "05:00"], ["08:30", "15:30"], ["19:00", "22:30"]],
    "Група 6.2": [["05:00", "12:00"], ["15:30", "20:00"], ["22:30", "24:00"]]
};

// Переведення часу у хвилини
function toMinutes(t) {
    const [h, m] = t.split(":").map(Number);
    return h * 60 + m;
}

// Кольори
const COLOR_POWER_ON = "#FFD700"; // жовтий
const COLOR_POWER_OFF = "#000000"; // чорний

let groups = Object.keys(outages);
let traces = [];

// Формування ліній
groups.forEach((group) => {
    const intervals = outages[group];

    if (intervals.length === 0) {
        traces.push({
            x: [0, 1440],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_ON },
            hoverinfo: "text",
            text: `${group}: Електроенергія є`,
            showlegend: false
        });
        return;
    }

    let last = 0;

    intervals.forEach((interval) => {
        const start = toMinutes(interval[0]);
        const end = toMinutes(interval[1]);

        if (start > last) {
            traces.push({
                x: [last, start],
                y: [group, group],
                mode: "lines",
                line: { width: 18, color: COLOR_POWER_ON },
                hoverinfo: "text",
                text: `${group}: Електроенергія є`,
                showlegend: false
            });
        }

        traces.push({
            x: [start, end],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_OFF },
            hoverinfo: "text",
            text: `${group}: Відключення ${interval[0]}–${interval[1]}`,
            showlegend: false
        });

        last = end;
    });

    if (last < 1440) {
        traces.push({
            x: [last, 1440],
            y: [group, group],
            mode: "lines",
            line: { width: 18, color: COLOR_POWER_ON },
            hoverinfo: "text",
            text: `${group}: Електроенергія є`,
            showlegend: false
        });
    }
});

// Поточний час
function getCurrentMinutes() {
    const now = new Date();
    return now.getHours() * 60 + now.getMinutes();
}

const layout = {
    title: "Відключення електроенергії по всіх групах",
    showlegend: false,
    xaxis: {
        title: "Час",
        range: [0, 1440],
        tickvals: Array.from({ length: 25 }, (_, i) => i * 60),
        ticktext: Array.from({ length: 25 }, (_, i) => `${i}:00`)
    },
    yaxis: { title: "Групи" },
    shapes: [
        {
            type: "line",
            x0: getCurrentMinutes(),
            x1: getCurrentMinutes(),
            y0: -1,
            y1: groups.length,
            line: { color: "red", width: 2, dash: "dash" }
        }
    ]
};

Plotly.newPlot("chart", traces, layout);

// Оновлення кожну хвилину
setInterval(() => {
    const current = getCurrentMinutes();
    Plotly.relayout("chart", {
        "shapes[0].x0": current,
        "shapes[0].x1": current
    });
}, 60000);
</script>

</body>
</html>
